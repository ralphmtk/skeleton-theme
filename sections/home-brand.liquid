<section class="home-brand full-width" id="home-brand-section">
  <div class="home-brand__container full-width">
    <div class="home-brand__wrapper">
      <div class="home-brand__content">
      <!-- Chevron indicator -->
      <div class="home-brand__chevron" id="home-brand-chevron">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="#1d9ec8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <!-- Words container -->
      <div class="home-brand__words">
        <div class="home-brand__spacer"></div>
        <div class="home-brand__word" data-word="0">1000+ Designs</div>
        <div class="home-brand__word" data-word="1">Global Leader</div>
        <div class="home-brand__word" data-word="2">Relentless Innovation</div>
        <div class="home-brand__word" data-word="3">Sustainability</div>
        <div class="home-brand__word" data-word="4">Iconic Partnerships</div>
        <div class="home-brand__spacer"></div>
      </div>

      <!-- Image placeholder container -->
      <div class="home-brand__image-container">
        <div class="home-brand__image-placeholder" data-image="0">Animation 1</div>
        <div class="home-brand__image-placeholder" data-image="1">Animation 2</div>
        <div class="home-brand__image-placeholder" data-image="2">Animation 3</div>
        <div class="home-brand__image-placeholder" data-image="3">Animation 4</div>
        <div class="home-brand__image-placeholder" data-image="4">Animation 5</div>
      </div>
    </div>
    </div>
  </div>

  {% stylesheet %}
    .home-brand {
      position: relative;
    }
    .home-brand__container {
      height: calc(100vh + 4 * 100vh);
      position: relative;
      background-color: rgb(188, 226, 239);
    }
    .home-brand__wrapper {
      width: 100%;
      height: 100vh;
      position: sticky;
      top: 0;
      overflow: hidden;
    }
    .home-brand__content {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      position: relative;
    }

    /* Chevron */
    .home-brand__chevron {
      position: absolute;
      left: 80px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
      pointer-events: none;
    }
    .home-brand__chevron svg {
      display: block;
    }

    /* Words container */
    .home-brand__words {
      position: absolute;
      left: 160px;
      top: 0;
      width: auto;
      display: flex;
      flex-direction: column;
      gap: 8rem; /* Increased spacing between words for empty space between transitions */
      align-items: flex-start;
      will-change: transform;
    }

    /* Spacer for before first and after last word */
    .home-brand__spacer {
      height: 15vh;
      width: 100%;
    }

    /* Individual word styling */
    .home-brand__word {
      font-size: clamp(2rem, 4vw, 4rem);
      font-weight: 700;
      color: rgba(188, 226, 239, 0.4); /* Inactive brand blue with reduced opacity */
      transition: all 0.4s ease;
      white-space: nowrap;
      text-align: left;
      line-height: 1.2;
    }

    /* Active word styling */
    .home-brand__word.is-active {
      color: #1d9ec8; /* Active brand blue */
      opacity: 1;
      transform: scale(1.1);
      text-shadow: 0 0 30px rgba(29, 158, 200, 0.6);
    }

    /* Inactive words */
    .home-brand__word:not(.is-active) {
      opacity: 0.5;
    }

    /* Image container */
    .home-brand__image-container {
      position: absolute;
      right: 80px;
      top: 50%;
      transform: translateY(-50%);
      width: 400px;
      height: 400px;
      z-index: 5;
    }

    /* Image placeholder */
    .home-brand__image-placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      background-color: white;
      opacity: 0;
      transition: opacity 0.6s ease-in-out;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 600;
      color: #1d9ec8;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(29, 158, 200, 0.2);
    }

    .home-brand__image-placeholder.is-active {
      opacity: 1;
    }
  {% endstylesheet %}

  <script>
    (function() {
      var section = document.getElementById('home-brand-section');
      if (!section) return;

      var words = Array.prototype.slice.call(section.querySelectorAll('.home-brand__word:not(.home-brand__spacer)'));
      var chevron = document.getElementById('home-brand-chevron');
      var wordCount = words.length;
      var scrollRange = 4 * window.innerHeight; // Section stays sticky for 4 viewport heights of scroll
      var stickyStartScroll = null;

      function updateActiveWord() {
        var currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        var rect = section.getBoundingClientRect();
        var wordsContainer = section.querySelector('.home-brand__words');
        var scrollProgress = 0;

        // Calculate progress through the sticky scroll range
        if (rect.top > 0) {
          // Section hasn't reached viewport top yet - track when it will become sticky
          stickyStartScroll = currentScroll + rect.top;
          scrollProgress = 0;
        } else {
          // Section is sticky
          if (stickyStartScroll === null) {
            // First time becoming sticky - set the start point
            stickyStartScroll = currentScroll;
          }
          // Calculate progress based on how much we've scrolled past the sticky start
          var scrolledPastStart = currentScroll - stickyStartScroll;
          scrollProgress = Math.min(1, Math.max(0, scrolledPastStart / scrollRange));
        }

        // Calculate initial position accounting for spacers
        var viewportCenter = window.innerHeight / 2;
        var wordsContainer = section.querySelector('.home-brand__words');
        var allChildren = Array.prototype.slice.call(wordsContainer.children);
        
        // Find first and last actual word elements (not spacers)
        var firstWordElement = allChildren.find(function(el) { return el.classList.contains('home-brand__word') && !el.classList.contains('home-brand__spacer'); });
        var lastWordElement = allChildren.filter(function(el) { return el.classList.contains('home-brand__word') && !el.classList.contains('home-brand__spacer'); }).pop();
        
        // Find the spacers
        var topSpacer = allChildren[0];
        var bottomSpacer = allChildren[allChildren.length - 1];
        
        var topSpacerCenter = topSpacer.offsetTop + (topSpacer.offsetHeight / 2);
        var firstWordCenter = firstWordElement.offsetTop + (firstWordElement.offsetHeight / 2);
        var lastWordCenter = lastWordElement.offsetTop + (lastWordElement.offsetHeight / 2);
        var bottomSpacerCenter = bottomSpacer.offsetTop + (bottomSpacer.offsetHeight / 2);
        
        // Total distance from top spacer center to bottom spacer center
        var totalDistance = bottomSpacerCenter - topSpacerCenter;
        
        // Calculate container offset based on scroll progress
        // At progress 0: top spacer at center (no words active)
        // At progress 1: bottom spacer at center (no words active)
        var initialOffset = viewportCenter - topSpacerCenter;
        var scrollOffset = scrollProgress * totalDistance;
        var containerOffset = initialOffset - scrollOffset;
        
        // Apply transform to move the container up as user scrolls
        wordsContainer.style.transform = 'translateY(' + containerOffset + 'px)';

        // Determine which word is closest to center (active word)
        // First check if we're in a spacer area - if so, no word should be active
        var firstWordRect = firstWordElement.getBoundingClientRect();
        var lastWordRect = lastWordElement.getBoundingClientRect();
        var viewportCenterY = viewportCenter;
        
        // Check if viewport center is before the first word or after the last word (in spacer areas)
        var isBeforeFirstWord = viewportCenterY < firstWordRect.top;
        var isAfterLastWord = viewportCenterY > lastWordRect.bottom;
        
        var activeIndex = -1;
        
        // Only find the closest word if we're actually in the word area (not in spacers)
        if (!isBeforeFirstWord && !isAfterLastWord) {
          var minDistance = Infinity;
          
          words.forEach(function(word, index) {
            var wordRect = word.getBoundingClientRect();
            var wordCenter = wordRect.top + (wordRect.height / 2);
            var distance = Math.abs(wordCenter - viewportCenterY);
            
            if (distance < minDistance) {
              minDistance = distance;
              activeIndex = index;
            }
          });
        }

        // Update word states
        words.forEach(function(word, index) {
          if (index === activeIndex) {
            word.classList.add('is-active');
          } else {
            word.classList.remove('is-active');
          }
        });

        // Update image placeholder states
        var imagePlaceholders = section.querySelectorAll('.home-brand__image-placeholder');
        imagePlaceholders.forEach(function(placeholder, index) {
          if (index === activeIndex && activeIndex >= 0) {
            placeholder.classList.add('is-active');
          } else {
            placeholder.classList.remove('is-active');
          }
        });
      }

      // Throttle scroll events for performance
      var ticking = false;
      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            updateActiveWord();
            ticking = false;
          });
          ticking = true;
        }
      }

      // Initialize
      updateActiveWord();
      window.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', function() {
        scrollRange = 4 * window.innerHeight;
        stickyStartScroll = null; // Reset on resize
        updateActiveWord();
      }, { passive: true });
    })();
  </script>

  {% schema %}
  {
    "name": "Home Brand",
    "settings": [],
    "presets": [
      { "name": "Home Brand" }
    ]
  }
  {% endschema %}
</section>

